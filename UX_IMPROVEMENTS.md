# UX/λ΅μ§ κ°μ„  μ™„λ£ μ”μ•½

## β… μ™„λ£λ κ°μ„  μ‚¬ν•­

### 1. π¨ μ¤ν”„λ‹ UX μ „λ©΄ μμ • (In-Chat Selection)

#### λ³€κ²½ μ „
- μ•± μ‹¤ν–‰ μ‹ νμ—…λλ” 'μ¤ν”„λ‹ μΉ΄λ“ 4κ° μ„ νƒ ν™”λ©΄'
- λ°μ…μ„ λ°©ν•΄ν•κ³  μ΄μ¤λ¬μ΄ UX

#### λ³€κ²½ ν›„
- **μ¦‰μ‹ μ±„ν…λ°© μ§„μ…**: μ μ €λ” μ•± μ‹¤ν–‰ μ‹ λ°”λ΅ λΉ μ±„ν…λ°©μΌλ΅ μ§„μ…
- **μ‹μ¤ν… μ„ κ³µ**: 'μ‹μ¤ν…(Narrator)'μ΄ λ¨Όμ € λ©”μ‹μ§€ μ „μ†΅
  > *"λ…μ›” μ•„μΉ΄λ°λ―Έμ— μ¤μ‹  κ²ƒμ„ ν™μν•©λ‹λ‹¤. λ‹Ήμ‹ μ μ΄μ•ΌκΈ°λ” μ–΄λ””μ„ μ‹μ‘λ©λ‹κΉ?"*
- **μΈ-μ•± μ„ νƒμ§€**: ν…μ¤νΈ μ…λ ¥μ°½ μ„μ— **μ„ νƒμ§€ λ²„νΌ** ν•νƒλ΅ 4κ°€μ§€ μ¤ν”„λ‹ μ‹λ‚λ¦¬μ¤ λ…Έμ¶
- **μμ—°μ¤λ¬μ΄ νλ¦„**: λ²„νΌ ν΄λ¦­ μ‹ ν•΄λ‹Ή μ‹λ‚λ¦¬μ¤ ν…μ¤νΈκ°€ μ μ € λ§ν’μ„ μΌλ΅ μ „μ†΅λκ³ , μ΄ν›„ λ΅μ§μ€ κΈ°μ΅΄κ³Ό λ™μΌ

#### κµ¬ν„ νμΌ
- `static/index.html`: μ¤ν”„λ‹ ν™”λ©΄ μ κ±°, μ±„ν…λ°© μ¦‰μ‹ μ§„μ…, μ„ νƒμ§€ λ²„νΌ UI μ¶”κ°€
- `api/opening.py`: κΈ°μ΅΄ λ΅μ§ μ μ§€ (λ³€κ²½ μ—†μ)

---

### 2. π§  λ©€ν‹° μ—μ΄μ „νΈ λ΅μ§ κ°•ν™”: "μ—°μ‡„ λ°μ‘(Chain Reaction)"

#### λ³€κ²½ μ „
- `3ν„΄λ§λ‹¤ λλ¤ κµμ²΄` λ΅μ§λ§ μ΅΄μ¬
- NPC Aκ°€ Bλ¥Ό λ¶λ¬λ„ Bκ°€ λ€λ‹µν•μ§€ μ•κ³  μ μ € ν„΄μΌλ΅ λ„μ–΄κ°
- κΈ°κ³„μ μ΄κ³  μ–΄μƒ‰ν• λ€ν™” νλ¦„

#### λ³€κ²½ ν›„
- **λ©μ… νΈλ¦¬κ±° (Mention Trigger)**: ν„μ¬ ν™”μ(A)μ λ‹µλ³€μ— λ‹¤λ¥Έ NPC(B)μ μ΄λ¦„μ΄ ν¬ν•¨λλ©΄ μ¦‰μ‹ Bκ°€ μ‘λ‹µ
- **μ—°μ‡„ λ°ν™”**: μ μ € μ…λ ¥ μ—†μ΄ [Aμ λ§ν’μ„ ] β†’ [Bμ λ§ν’μ„ ]μ΄ μ—°λ‹¬μ•„ μ¶λ ¥
- **μμ—°μ¤λ¬μ΄ ν‹°ν‚¤νƒ€μΉ΄**: "κΌ¬λ¦¬μ— κΌ¬λ¦¬λ¥Ό λ¬΄λ” λ€ν™”" κµ¬ν„

#### κµ¬ν„ λ΅μ§

```python
# 1. NPC Aμ μ‘λ‹µ μƒμ„±
response_A = generate_npc_response(speaker=NPC_A)

# 2. λ©μ… κ°μ§€ (Aκ°€ Bλ¥Ό λ¶λ €λ”κ°€?)
mentioned_npc = detect_mentioned_npc(response_A.text, current_location_npcs, exclude_character_id=NPC_A.id)

# 3. μ–ΈκΈ‰λ NPCκ°€ μ¦‰μ‹ λ°μ‘
if mentioned_npc:
    context_for_B = f"{NPC_A.name} just said: '{response_A.text}' talking to you."
    response_B = generate_npc_response(speaker=mentioned_npc, input=context_for_B)
    # Bμ λ§ν’μ„  μ—°λ‹¬μ•„ μ¶λ ¥
```

#### κµ¬ν„ νμΌ
- `core/speaker_selector.py`: `detect_mentioned_npc()` ν•¨μ μ¶”κ°€
- `api/chat_multi.py`: μ—°μ‡„ λ°μ‘ λ΅μ§ μ¶”κ°€, `chained_responses` ν•„λ“ μ¶”κ°€
- `static/index.html`: μ—°μ‡„ λ°μ‘ λ©”μ‹μ§€ ν‘μ‹ λ΅μ§ μ¶”κ°€ (500ms λ”λ μ΄)

---

## π§ ν…μ¤νΈ μ‹λ‚λ¦¬μ¤

### 1. μ¤ν”„λ‹ ν…μ¤νΈ
1. μ•± μ‹¤ν–‰ β†’ μ±„ν…λ°© μ¦‰μ‹ μ§„μ…
2. μ‹μ¤ν… λ©”μ‹μ§€ ν™•μΈ: *"λ…μ›” μ•„μΉ΄λ°λ―Έμ— μ¤μ‹  κ²ƒμ„ ν™μν•©λ‹λ‹¤..."*
3. μ„ νƒμ§€ λ²„νΌ 4κ° ν™•μΈ (μ…λ ¥μ°½ μ„)
4. "κΈ°μ™μ‚¬ λ΅λΉ„(μ‹ κ³ μ‹)" λ²„νΌ ν΄λ¦­
5. μ μ € λ§ν’μ„ μ— μ„ νƒν• μ‹λ‚λ¦¬μ¤ ν‘μ‹
6. μ£Όμ°½μ¤μ μ²« λ€μ‚¬ ν‘μ‹

### 2. μ—°μ‡„ λ°μ‘ ν…μ¤νΈ
1. μ μ €: *"μ•Ό, λ„λ„¤ μ‹λ„λ¬μ›. μ†μ— μλ” ν™©μΈν• μ„ λ°°κ°€ μ³λ‹¤λ³΄μ–μ•„."*
2. μ£Όμ°½μ¤: *"λ­? μΈν• λ„λ‹μ΄ λ‚  μ™ λ΄? ν—›μ†λ¦¬ν•μ§€ λ§."*
3. **(μ‹μ¤ν… μλ™ κ°μ§€: 'μΈν• λ„λ‹' μ–ΈκΈ‰)**
4. **ν™©μΈν• (μ¦‰μ‹ λ“±ν, 500ms ν›„):** *"μ‹λ„λ¬μ›, μ£Όμ°½μ¤. μ‹ μ…μƒ κ²μ£Όμ§€ λ§κ³  λΉ„μΌ."*
5. β… λ‘ κ°μ λ§ν’μ„ μ΄ μ—°λ‹¬μ•„ λ‚μ¤λ©΄ μ„±κ³µ

---

## π“ κΈ°μ μ  μ„Έλ¶€μ‚¬ν•­

### API μ‘λ‹µ κµ¬μ΅° λ³€κ²½

**Before:**
```json
{
  "character_response": "...",
  "character_name": "...",
  ...
}
```

**After:**
```json
{
  "character_response": "...",
  "character_name": "...",
  "chained_responses": [
    {
      "character_id": "npc_hwang_inha",
      "character_name": "ν™©μΈν•",
      "character_response": "...",
      "triggered_by": "μ£Όμ°½μ¤",
      "trigger_message": "..."
    }
  ],
  ...
}
```

### ν”„λ΅ νΈμ—”λ“ μ²λ¦¬
- μ—°μ‡„ λ°μ‘ λ©”μ‹μ§€λ” 500ms λ”λ μ΄ ν›„ ν‘μ‹ (μμ—°μ¤λ¬μ›€)
- μ—¬λ¬ μ—°μ‡„ λ°μ‘μ΄ μμ„ κ²½μ° μμ°¨μ μΌλ΅ ν‘μ‹ (300ms κ°„κ²©)

---

## π― κ°μ„  ν¨κ³Ό

1. **λ°μ…λ„ ν–¥μƒ**: μ¤ν”„λ‹ μ„ νƒμ΄ μ±„ν… λ‚΄μ—μ„ μμ—°μ¤λ½κ² μ΄λ£¨μ–΄μ§
2. **λ€ν™” νλ¦„ κ°μ„ **: NPC κ°„ μƒνΈμ‘μ©μΌλ΅ λ” μƒλ™κ° μλ” λ€ν™”
3. **μ‚¬μ©μ κ²½ν— ν–¥μƒ**: κΈ°κ³„μ μΈ ν„΄ κµμ²΄ λ€μ‹  μμ—°μ¤λ¬μ΄ ν‹°ν‚¤νƒ€μΉ΄ κµ¬ν„
