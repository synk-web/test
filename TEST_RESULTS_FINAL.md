# SYNK v2.1 μµμΆ… ν…μ¤νΈ κ²°κ³Ό

**ν…μ¤νΈ λ‚ μ§**: 2024λ…„  
**μμ • μ‚¬ν•­**: μ—°μ‡„ λ°μ‘ Scene Context μ—…λ°μ΄νΈ μ¶”κ°€

---

## β… μµμΆ… ν…μ¤νΈ κ²°κ³Ό: μ„±κ³µ!

### ν…μ¤νΈ μ‹λ‚λ¦¬μ¤

```
ν„΄ 1: "μ£Όμ°½μ¤ λ„ μ™ μ΄λ ‡κ² μ¬μμ—†μ–΄?"
  β†’ μ£Όμ°½μ¤ μ‘λ‹µ
  β†’ last_speaker: μ£Όμ°½μ¤ β…

ν„΄ 2: "ν™©μΈν• λ„ λ­μ•Ό?"
  β†’ ν™©μΈν• μ‘λ‹µ
  β†’ last_speaker: ν™©μΈν• β…

ν„΄ 3: "λ„ λ­”λ°?"
  β†’ ν™©μΈν• μ‘λ‹µ β…
  β†’ selection_reason: "pronoun:λ„β†’ν™©μΈν•" β…
  β†’ last_speaker: ν™©μΈν• β…
```

**κ²°κ³Ό**: β… **μ™„λ²½ μ„±κ³µ!**

---

## π”§ μμ • μ™„λ£ μ‚¬ν•­

### 1. μ—°μ‡„ λ°μ‘ Scene Context μ—…λ°μ΄νΈ

**λ¬Έμ **: μ—°μ‡„ λ°μ‘(λ‚μ…) μΊλ¦­ν„°μ μ‘λ‹µμ΄ Scene Contextμ— λ°μλμ§€ μ•μ

**ν•΄κ²°**: `api/chat_multi.py`μ— μ—°μ‡„ λ°μ‘ μ²λ¦¬ ν›„ Scene Context μ—…λ°μ΄νΈ μ¶”κ°€

```python
# μ—°μ‡„ λ°μ‘ μƒμ„± ν›„
scene_manager.process_character_response(
    session_id=session_id,
    character_id=mentioned_npc.id,
    character_name=mentioned_npc.name,
    response=chained_response,
    target="user",
    target_name="μ μ €"
)
```

### 2. λ””λ²„κ·Έ λ΅κ·Έ μ¶”κ°€

- Scene Manager: last_speaker μ—…λ°μ΄νΈ λ΅κ·Έ
- Speaker Selector: λ€λ…μ‚¬ κ°μ§€ λ΅κ·Έ
- chat_multi: λ€λ…μ‚¬ μ²λ¦¬ ν™•μΈ λ΅κ·Έ

### 3. Scene Context ν”„λ΅¬ν”„νΈ ν†µν•©

μ—°μ‡„ λ°μ‘ ν”„λ΅¬ν”„νΈμ—λ„ Scene Context ν¬ν•¨ν•μ—¬ λ§¥λ½ μ μ§€

---

## π“ ν…μ¤νΈ κ²°κ³Ό μƒμ„Έ

| ν…μ¤νΈ | μ…λ ¥ | μμƒ κ²°κ³Ό | μ‹¤μ  κ²°κ³Ό | ν†µκ³Ό |
|--------|------|-----------|-----------|------|
| λ€λ…μ‚¬ "λ„" (μΌλ°) | "λ„ λ­”λ°?" | μ§μ „ ν™”μ μ‘λ‹µ | ν™©μΈν• μ‘λ‹µ | β… |
| λ€λ…μ‚¬ "λ„" (μ—°μ‡„ λ°μ‘ ν›„) | "λ„ λ­”λ°?" | μ—°μ‡„ λ°μ‘ ν™”μ μ‘λ‹µ | ν™©μΈν• μ‘λ‹µ | β… |
| μ§μ ‘ νΈλ… | "μ£Όμ°½μ¤ λ­ν•΄?" | μ£Όμ°½μ¤ μ‘λ‹µ | μ£Όμ°½μ¤ μ‘λ‹µ | β… |
| Scene Context | λ€ν™” μ§„ν–‰ | last_speaker μ—…λ°μ΄νΈ | β… μ—…λ°μ΄νΈλ¨ | β… |
| μ—°μ‡„ λ°μ‘ | NPC μ–ΈκΈ‰ | μλ™ μ‘λ‹µ | β… μ‘λ™ | β… |

**μ΄ 5κ° ν…μ¤νΈ μ¤‘ 5κ° μ„±κ³µ (100%)**

---

## π― ν•µμ‹¬ κ°μ„  μ‚¬ν•­

### Before (μμ • μ „)

```
ν™©μΈν• λ‚μ… β†’ μ‘λ‹µ μƒμ„±
β†’ Scene Context λ―Έμ—…λ°μ΄νΈ
β†’ last_speaker = μ£Όμ°½μ¤ (μ΄μ „ κ°’ μ μ§€)
β†’ "λ„ λ­”λ°?" β†’ μ£Όμ°½μ¤ μ‘λ‹µ β
```

### After (μμ • ν›„)

```
ν™©μΈν• λ‚μ… β†’ μ‘λ‹µ μƒμ„±
β†’ Scene Context μ—…λ°μ΄νΈ β…
β†’ last_speaker = ν™©μΈν• (κ°±μ‹ λ¨)
β†’ "λ„ λ­”λ°?" β†’ ν™©μΈν• μ‘λ‹µ β…
```

---

## π“ μ„λ²„ λ΅κ·Έ μμ‹

```
[Scene Manager] μΊλ¦­ν„° μ‘λ‹µ μ²λ¦¬: μ£Όμ°½μ¤ β†’ last_speaker μ—…λ°μ΄νΈλ¨
[Scene Manager] μΊλ¦­ν„° μ‘λ‹µ μ²λ¦¬: ν™©μΈν• β†’ last_speaker μ—…λ°μ΄νΈλ¨
[Speaker Selector] λ€λ…μ‚¬ 'λ„' κ°μ§€ β†’ μ§μ „ ν™”μ 'ν™©μΈν•' μ„ νƒ
[DEBUG] λ€λ…μ‚¬ μ²λ¦¬ ν™•μΈ
- μ μ € λ©”μ‹μ§€: λ„ λ­”λ°?
- μ„ νƒλ ν™”μ: ν™©μΈν•
- μ„ νƒ μ΄μ : pronoun:λ„β†’ν™©μΈν•
- Scene Context last_speaker: ν™©μΈν•
```

---

## β… μµμΆ… κ²°λ΅ 

**λ€λ…μ‚¬ μ²λ¦¬ λ¬Έμ κ°€ μ™„μ „ν ν•΄κ²°λμ—μµλ‹λ‹¤!**

- β… μ—°μ‡„ λ°μ‘ ν›„ Scene Context μ •μƒ μ—…λ°μ΄νΈ
- β… last_speaker μ •ν™•ν κ°±μ‹ 
- β… λ€λ…μ‚¬κ°€ μ§μ „ ν™”μλ¥Ό μ •ν™•ν κ°€λ¦¬ν‚΄
- β… selection_reason μ •ν™•ν ν‘μ‹

**λ¨λ“  ν•µμ‹¬ κΈ°λ¥μ΄ μ •μƒ μ‘λ™ν•©λ‹λ‹¤!** π‰

---

**ν…μ¤νΈ μ™„λ£ λ‚ μ§**: 2024λ…„  
**κ²°κ³Ό**: β… **100% μ„±κ³µ**
