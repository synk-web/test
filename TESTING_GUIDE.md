# 씬 리액션 시스템 테스트 가이드

## 🔧 수정 완료 사항

### 1. 직접 호명 감지 강화 ✅
- 애칭 매칭 추가 (인하야, 인하씨 등)
- 디버그 로그 추가

### 2. "모두" 트리거 로직 개선 ✅
- 직접 호명된 캐릭터는 무조건 main
- recent 캐릭터는 main으로 처리

### 3. Scene Context 업데이트 범위 확대 ✅
- 메인 응답자뿐만 아니라 서브 리액션, 무반응 캐릭터도 속마음 업데이트

### 4. 프론트엔드 씬 리액션 UI 추가 ✅
- 메인 응답 표시
- 서브 리액션 패널 추가
- CSS 스타일 추가

---

## 🧪 테스트 방법

### 테스트 1: "모두" 트리거

**입력**: "야 너희들 들어봐"

**예상 결과**:
- `main_responses`: 2명 이상 (recent 캐릭터들)
- `sub_reactions`: 나머지 캐릭터들
- `no_reaction`: 관심 없는 캐릭터 (속마음만)

**확인 사항**:
1. 서버 로그에서 `[Scene Reaction] 반응 범위: all` 확인
2. API 응답에서 `main_responses`, `sub_reactions` 필드 확인
3. 프론트엔드에서 "💭 주변 반응" 패널 표시 확인

### 테스트 2: 직접 호명

**입력**: "표다은! 너 주창윤 좋아해?"

**예상 결과**:
- `main_responses`: 표다은 (직접 호명)
- `sub_reactions`: 나머지 캐릭터들

**확인 사항**:
1. 서버 로그에서 `[Scene Reaction] 직접 호명 감지: '표다은'` 확인
2. API 응답에서 첫 번째 `main_responses`의 `character_name`이 "표다은"인지 확인

### 테스트 3: 서브 리액션 UI

**확인 사항**:
1. 메인 응답이 순차적으로 표시되는지
2. "💭 주변 반응" 패널이 표시되는지
3. 서브 리액션 목록이 표시되는지
4. 속마음이 표시되는지

---

## 📊 서버 로그 확인

서버 로그에서 다음을 확인할 수 있습니다:

```
[Scene Reaction] 반응 범위: all (메시지: '야 너희들 들어봐')
[Scene Reaction] 주창윤: main (직접 호명: False)
[Scene Reaction] 황인하: reaction (직접 호명: False)
[Scene Reaction] 표다은: main (직접 호명: False)
...
```

---

## 🔍 문제 해결

### 문제: "모두" 트리거가 작동하지 않음

**확인 사항**:
1. `FULL_REACTION_TRIGGERS`에 키워드가 포함되어 있는지
2. `analyze_reaction_scope()` 함수가 "all"을 반환하는지
3. 서버 로그 확인

### 문제: 직접 호명이 작동하지 않음

**확인 사항**:
1. 캐릭터 이름이 정확히 일치하는지
2. 애칭 매칭이 작동하는지
3. 서버 로그에서 `[Scene Reaction] 직접 호명 감지` 확인

### 문제: 서브 리액션 UI가 표시되지 않음

**확인 사항**:
1. API 응답에 `sub_reactions` 필드가 있는지
2. 프론트엔드 코드가 `data.sub_reactions`를 처리하는지
3. 브라우저 콘솔에서 오류 확인

---

**작성일**: 2024년
