# SYNK MVP 개발 명세서 v2.0

> 이 문서는 프론트엔드/백엔드 개발자를 위한 기능 명세서입니다.

---

## 📋 목차

1. [이모지 리액션 시스템](#1-이모지-리액션-시스템)
2. [멀티 캐릭터 티키타카 시스템](#2-멀티-캐릭터-티키타카-시스템)
3. [유저 프로필 시스템](#3-유저-프로필-시스템)
4. [캐릭터 속마음 시스템](#4-캐릭터-속마음-시스템)

---

# 1. 이모지 리액션 시스템

## 1.1 개요

유저가 캐릭터의 대사에 **이모지로 반응**하여 감정 데이터를 수집하는 시스템입니다.
AI 분석보다 **100% 정확한 유저 직접 피드백**을 얻을 수 있습니다.

```
┌─────────────────────────────────────────────────┐
│ 👤 주창윤                                        │
│                                                 │
│ "하... 야. 문 닫아. 냄새 들어오잖아.              │
│  ...뭐야 이 맹하게 생긴 놈은? 신입이냐?"          │
│                                                 │
│  ┌─────────────────────────────────────┐       │
│  │  [❤️]   [💢]   [🔥]   [⭐]          │       │
│  │  심쿵    짜증    열광   기억해!       │       │
│  └─────────────────────────────────────┘       │
└─────────────────────────────────────────────────┘
```

## 1.2 이모지 4종류 정의

| 이모지 | 이름 | 의미 | 저장 데이터 | 효과 |
|--------|------|------|-------------|------|
| ❤️ | 심쿵 | 좋아/설렘 | emotion: "joy" | intimacy +0.3, joy_peaks +1 |
| 💢 | 짜증 | 화남/불쾌 | emotion: "anger" | anger_peaks +1, 트리거 후보 등록 |
| 🔥 | 열광 | 흥분/재밌음 | emotion: "excitement" | excitement_peaks +1 |
| ⭐ | 기억해! | 이 순간 저장 | core_memory 생성 | 핵심 기억으로 영구 저장 |

## 1.3 UI 요구사항

### 버튼 위치
- 각 캐릭터 대사 말풍선 **아래**에 표시
- 유저가 클릭하기 전까지 **반투명** 상태
- 클릭하면 **활성화 애니메이션** + 색상 변경

### 버튼 상태
```
[비활성] 회색, 반투명 (opacity: 0.5)
[호버]   해당 이모지 색상으로 변경
[클릭]   활성화 + 작은 애니메이션 (팝업 효과)
[선택됨] 해당 이모지 아래 밑줄 또는 테두리
```

### 다중 선택
- **❤️💢🔥는 상호 배타적** (하나만 선택 가능)
- **⭐는 독립적** (다른 이모지와 함께 선택 가능)
- 예: ❤️ + ⭐ 동시 선택 가능 (심쿵 + 기억해!)

## 1.4 API 명세

### 이모지 리액션 전송

```http
POST /api/reaction/
Content-Type: application/json

{
  "user_id": "user123",
  "character_id": "npc_joo_changyun",
  "turn_id": "turn_uuid_here",
  "emoji": "❤️",
  "user_message": "무슨냄새 이상한놈이네...",
  "character_response": "하... 야. 문 닫아..."
}
```

### 응답

```json
{
  "success": true,
  "message": "심쿵 반응이 기록되었습니다!",
  "relationship_data": {
    "intimacy": 0.5,
    "dominance": 0.2,
    "emotional_stats": {
      "joy_peaks": 2,
      "anger_peaks": 0,
      "excitement_peaks": 1
    },
    "core_memories_count": 1,
    "trigger_keywords_count": 0
  }
}
```

## 1.5 데이터 처리 흐름

```
유저가 💢 클릭
    │
    ▼
┌─────────────────────────────────────────┐
│ 1. 감정 로그 저장                         │
│    emotion: "anger"                      │
│    intensity: 7.0                        │
│    source: "emoji" (100% 신뢰)           │
│    confidence: 1.0                       │
└─────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────┐
│ 2. 통계 업데이트                          │
│    anger_peaks += 1                      │
└─────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────┐
│ 3. 트리거 키워드 후보 등록 (💢만 해당)      │
│    캐릭터 대사에서 명사 추출               │
│    예: "냄새", "신입" → 트리거 후보        │
│    2회 이상 반복 시 확정 트리거로 저장      │
└─────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────┐
│ 4. AI 분석 스킵 (비용 절약)               │
│    이모지가 있으면 AI 감정 분석 안 함      │
└─────────────────────────────────────────┘
```

## 1.6 핵심 기억 (⭐) 처리

```
유저가 ⭐ 클릭
    │
    ▼
┌─────────────────────────────────────────┐
│ AI가 대화 요약 생성                       │
│ "유저가 주창윤의 상의를 찢으며 위협함"      │
└─────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────┐
│ 핵심 기억 저장 (최대 20개)                │
│ {                                        │
│   "summary": "유저가 주창윤을 위협함",     │
│   "trigger_keywords": ["상의", "찢다"],   │
│   "character_emotion": "당황",           │
│   "user_emotion": "분노",                │
│   "memorable_quote": "죽고싶냐?",         │
│   "user_marked": true                    │
│ }                                        │
└─────────────────────────────────────────┘
```

## 1.7 온보딩 (첫 사용자 안내)

```
[첫 번째 캐릭터 대사 후]

시스템 툴팁:
┌─────────────────────────────────────────┐
│ 💡 캐릭터의 말에 반응해보세요!            │
│                                         │
│ ❤️ 심쿵했을 때                           │
│ 💢 짜증날 때                             │
│ 🔥 열광할 때                             │
│ ⭐ 이 순간을 기억하고 싶을 때             │
│                                         │
│ 캐릭터가 당신의 반응을 기억합니다.        │
└─────────────────────────────────────────┘
```

---

# 2. 멀티 캐릭터 티키타카 시스템

## 2.1 개요

같은 장소에 있는 캐릭터들이 **서로 대화(티키타카)**하다가,
최종적으로 **유저에게 집중**하는 구조입니다.

**핵심 원칙:**
- 캐릭터들끼리 자연스럽게 티키타카
- 하지만 결국 **유저가 주인공**
- 유저가 주목받는 순간을 만들어야 함

## 2.2 대화 흐름 구조

```
┌─────────────────────────────────────────────────────────────┐
│                    멀티 캐릭터 대화 흐름                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [Phase 1: 유저 발화]                                        │
│  유저: "무슨 냄새 이상한놈이네..."                             │
│                                                             │
│  [Phase 2: 직접 대상 응답]                                    │
│  주창윤: "야, 뭐? 이상한 놈?" (유저에게)                       │
│                                                             │
│  [Phase 3: 티키타카 (캐릭터 간 대화)]                          │
│  주창윤 → 표다은: "표다은, 이런 애도 이제 막 뽑고 그러냐?"      │
│  표다은 → 주창윤: "창윤아, 말 좀 예쁘게 해."                   │
│  황인하 (관망): *창가에서 지켜보는 중*                         │
│                                                             │
│  [Phase 4: 유저에게 집중]                                     │
│  표다은 → 유저: "카카시 씨, 신경 쓰지 마. 쟤 원래 저래."       │
│  (모든 캐릭터의 시선이 유저에게)                               │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 2.3 Speaker Selector 로직

### 우선순위

```python
def select_next_speaker(user_message, current_location, conversation_history):
    """
    다음 화자 선택 로직
    
    우선순위:
    1. 유저가 직접 이름을 부른 경우 → 해당 캐릭터
    2. 유저가 "@캐릭터명" 멘션한 경우 → 해당 캐릭터
    3. 대화 맥락상 응답해야 하는 캐릭터 → AI 판단
    4. 마지막으로 대화한 캐릭터 → 대화 연속성
    5. 티키타카 가능한 캐릭터 → 랜덤 또는 관계 기반
    """
    
    # 1. 직접 호명
    for char in location_characters:
        if char.name in user_message:
            return char, "direct_mention"
    
    # 2. @ 멘션
    if "@" in user_message:
        mentioned = extract_mention(user_message)
        if mentioned:
            return mentioned, "at_mention"
    
    # 3. AI 맥락 판단 (프롬프트에 위임)
    return None, "ai_context"  # AI가 적절한 화자 선택
```

### AI 맥락 판단 프롬프트

```python
SPEAKER_SELECTION_PROMPT = """
[현재 장소: {location}]
[있는 캐릭터들]
{characters_info}

[최근 대화]
{recent_conversation}

[유저 발화]
{user_message}

[질문]
1. 누가 먼저 응답해야 하는가?
2. 캐릭터 간 티키타카가 필요한가?
3. 최종적으로 유저에게 어떻게 집중시킬 것인가?

[응답 형식]
{
  "primary_responder": "캐릭터ID",
  "tiki_taka": [
    {"from": "캐릭터A", "to": "캐릭터B", "content": "대사"},
    {"from": "캐릭터B", "to": "유저", "content": "대사"}
  ],
  "final_focus": "유저에게 집중하는 마무리 설명"
}
"""
```

## 2.4 티키타카 규칙

### 트리거 조건

```python
TIKI_TAKA_TRIGGERS = {
    # 키워드 기반
    "싸움/갈등": {
        "keywords": ["싸우다", "겨루다", "죽이다", "찢다"],
        "participants": ["주창윤", "황인하", "신채린"],
        "pattern": "갈등 고조 → 제3자 개입 → 유저 주목"
    },
    
    "도움 요청": {
        "keywords": ["도와줘", "알려줘", "어떻게"],
        "participants": ["표다은", "이가은"],
        "pattern": "조언 제공 → 다른 의견 제시 → 유저 선택권"
    },
    
    "신입 소개": {
        "keywords": ["신입", "처음", "누구"],
        "participants": ["all"],
        "pattern": "품평 → 관심/무관심 → 유저에게 질문"
    }
}
```

### 티키타카 예시

```
[상황: 유저가 주창윤에게 시비]

턴 1 - 유저: "창윤이랑 한번 겨뤄보고 싶은데?"

턴 2 - 표다은 → 유저: (중재)
"어어, 싸우지 마! 창윤이 쟤, 괜히 건드리면 피곤해질 텐데..."

턴 3 - 주창윤 → 표다은: (반박)
"표다은, 너 또 시작이냐? 쓸데없는 오지랖은."

턴 4 - 주창윤 → 유저: (도발)
"야, 카카시인가 뭔가. 네 수준엔 나 못 이겨."

턴 5 - 황인하: (개입)
"후후... 재미있네. 그 오만한 태도가 어디까지 갈지."

턴 6 - 황인하 → 유저: (최종 집중)
"근데 너, 함부로 나대다간 다치는 수가 있어. 알아두는 게 좋을 거야."

[결과: 모든 시선이 유저에게]
```

## 2.5 유저 주목 패턴

### "주인공 모먼트" 연출

```python
USER_FOCUS_PATTERNS = [
    {
        "name": "품평회",
        "description": "캐릭터들이 유저에 대해 이야기",
        "example": [
            "A → B: '쟤 뭐야? 신입이야?'",
            "B → A: '빌런과로 왔대.'",
            "A → 유저: '야, 넌 뭐 할 줄 알아?'"
        ]
    },
    {
        "name": "선택 강요",
        "description": "캐릭터들이 유저에게 선택을 요구",
        "example": [
            "A: '넌 내 편이야, 쟤 편이야?'",
            "B: '대답해 봐.'",
        ]
    },
    {
        "name": "관심 집중",
        "description": "모든 캐릭터가 유저를 주시",
        "example": [
            "*로비가 조용해진다*",
            "*모든 시선이 유저에게 쏠린다*",
            "A: '...뭐야, 대답 안 해?'"
        ]
    }
]
```

## 2.6 API 응답 구조 변경

### 기존

```json
{
  "character_response": "단일 대사"
}
```

### 변경 (티키타카 지원)

```json
{
  "turn_id": "uuid",
  "responses": [
    {
      "speaker_id": "npc_pyo_daeun",
      "speaker_name": "표다은",
      "target": "user",
      "message": "어어, 싸우지 마!",
      "action": "주창윤을 힐끗 보며",
      "emotion": "worried"
    },
    {
      "speaker_id": "npc_joo_changyun",
      "speaker_name": "주창윤",
      "target": "npc_pyo_daeun",
      "message": "표다은, 너 또 시작이냐?",
      "action": "혀를 차며",
      "emotion": "annoyed"
    },
    {
      "speaker_id": "npc_joo_changyun",
      "speaker_name": "주창윤",
      "target": "user",
      "message": "네 수준엔 나 못 이겨. 꺼져.",
      "action": "유저를 깔보며",
      "emotion": "arrogant"
    }
  ],
  "scene_description": "로비의 분위기가 험악해졌다. 모든 시선이 유저에게 쏠린다.",
  "user_focus": true
}
```

## 2.7 대화 상대 선택 UI

```
┌─────────────────────────────────────────┐
│ 메시지 입력창                            │
│ ┌─────────────────────────────────────┐ │
│ │                                     │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ [🎯 대화 상대: 전체 ▼]  [전송]           │
│                                         │
│ 드롭다운:                               │
│ ├── 전체 (알아서 반응)                  │
│ ├── 주창윤                              │
│ ├── 황인하                              │
│ ├── 표다은                              │
│ ├── 민아름                              │
│ └── 고선하                              │
└─────────────────────────────────────────┘
```

---

# 3. 유저 프로필 시스템

## 3.1 개요

유저(주인공)의 정보를 저장하고, 대화를 통해 **자동으로 업데이트**되는 시스템입니다.
캐릭터들이 유저를 더 잘 기억하고, 개인화된 반응을 할 수 있습니다.

## 3.2 유저 프로필 데이터 모델

```python
class UserProfile(BaseModel):
    """유저 프로필 (주인공 정보)"""
    
    user_id: str
    
    # ═══════════════════════════════════════
    # 기본 정보 (유저 직접 입력 또는 대화에서 추출)
    # ═══════════════════════════════════════
    nickname: Optional[str] = None       # "카카시"
    gender: Optional[str] = None         # "male" / "female" / "other"
    
    # ═══════════════════════════════════════
    # 능력 정보 (대화에서 자동 추출)
    # ═══════════════════════════════════════
    ability_name: Optional[str] = None   # "뇌절"
    ability_description: Optional[str] = None  # "손끝에 전기를 모아 적의 심장을 관통"
    ability_rank: Optional[str] = None   # 추정 등급
    
    # ═══════════════════════════════════════
    # 성격/특성 (대화 패턴에서 자동 분석)
    # ═══════════════════════════════════════
    personality_traits: List[str] = []   # ["도발적", "자신감", "충동적"]
    speech_style: Optional[str] = None   # "반말, 도발적, 유머 섞음"
    
    # ═══════════════════════════════════════
    # 관계 요약 (캐릭터별)
    # ═══════════════════════════════════════
    character_relationships: Dict[str, dict] = {}
    # {
    #   "npc_joo_changyun": {
    #     "status": "적대적",
    #     "key_events": ["상의를 찢음", "싸움을 걸음"],
    #     "their_impression": "만만해 보이는 놈"
    #   }
    # }
    
    # ═══════════════════════════════════════
    # 히스토리
    # ═══════════════════════════════════════
    key_actions: List[dict] = []         # 주요 행동 기록
    # [
    #   {"action": "주창윤의 상의를 찢음", "location": "베타_동_로비", "timestamp": "..."},
    #   {"action": "자신을 카카시라고 소개", "location": "베타_동_로비", "timestamp": "..."}
    # ]
    
    mentioned_facts: List[str] = []      # 유저가 언급한 사실들
    # ["뇌절 능력 보유", "전투를 즐김", "주창윤을 싫어함"]
    
    # ═══════════════════════════════════════
    # 메타데이터
    # ═══════════════════════════════════════
    created_at: datetime
    updated_at: datetime
```

## 3.3 자동 추출 로직

### 대화에서 정보 추출

```python
async def extract_user_info(user_message: str, context: dict) -> dict:
    """
    유저 메시지에서 프로필 정보 자동 추출
    """
    
    EXTRACTION_PROMPT = """
    [유저 메시지]
    {user_message}
    
    [대화 맥락]
    {context}
    
    [추출할 정보]
    - 닉네임/이름 언급 여부
    - 능력 설명 여부
    - 성격 특성 (도발적, 소심함, 유머러스 등)
    - 중요한 행동 (싸움, 협력, 거절 등)
    - 새로운 사실 (좋아하는 것, 싫어하는 것 등)
    
    [JSON 응답]
    {
      "nickname": "추출된 이름 또는 null",
      "ability": {"name": "능력명", "description": "설명"} 또는 null,
      "traits": ["특성1", "특성2"],
      "action": "주요 행동" 또는 null,
      "facts": ["새로운 사실1"]
    }
    """
    
    # AI로 추출
    result = await extract_with_ai(EXTRACTION_PROMPT.format(...))
    return result
```

### 추출 예시

```
유저: "내 이름은 카카시야. 내 주특기는 뇌절이고, 손끝에 전기를 모아 적의 심장을 관통하지"

추출 결과:
{
  "nickname": "카카시",
  "ability": {
    "name": "뇌절",
    "description": "손끝에 전기를 모아 적의 심장을 관통"
  },
  "traits": ["자신감", "과시적"],
  "action": "자기소개",
  "facts": ["전기 계열 능력 보유"]
}
```

## 3.4 프로필 업데이트 API

### 자동 업데이트 (대화 후)

```http
# 채팅 API 내부에서 자동 호출
POST /api/user/profile/extract
{
  "user_id": "user123",
  "user_message": "내 이름은 카카시야...",
  "context": { ... }
}
```

### 수동 업데이트 (유저 직접 수정)

```http
PUT /api/user/profile/{user_id}
{
  "nickname": "카카시",
  "gender": "male"
}
```

### 프로필 조회

```http
GET /api/user/profile/{user_id}
```

```json
{
  "success": true,
  "profile": {
    "user_id": "user123",
    "nickname": "카카시",
    "ability_name": "뇌절",
    "ability_description": "손끝에 전기를 모아 적의 심장을 관통",
    "personality_traits": ["도발적", "자신감", "충동적"],
    "character_relationships": {
      "npc_joo_changyun": {
        "status": "적대적",
        "their_impression": "만만해 보이는 놈"
      },
      "npc_pyo_daeun": {
        "status": "우호적",
        "their_impression": "재미있는 신입"
      }
    },
    "key_actions": [
      {"action": "주창윤의 상의를 찢음", "timestamp": "..."}
    ]
  }
}
```

## 3.5 캐릭터 프롬프트에 유저 정보 주입

```python
def build_prompt_with_user_profile(character, user_profile, rel_data):
    """
    캐릭터 프롬프트에 유저 정보 포함
    """
    
    prompt = f"""
[유저 정보]
- 이름: {user_profile.nickname or "알 수 없음"}
- 능력: {user_profile.ability_name or "알 수 없음"} - {user_profile.ability_description or ""}
- 성격: {", ".join(user_profile.personality_traits) or "파악 중"}
- 주요 행동: {user_profile.key_actions[-3:] if user_profile.key_actions else "없음"}

[당신({character.name})이 유저에 대해 아는 것]
- 관계: {rel_data.user_relationship}
- 인상: {user_profile.character_relationships.get(character.id, {}).get("their_impression", "첫인상")}
- 함께한 사건: {user_profile.character_relationships.get(character.id, {}).get("key_events", [])}

[지시]
- 유저를 "{user_profile.nickname}"이라고 부르세요.
- 유저의 능력이나 과거 행동을 자연스럽게 언급할 수 있습니다.
- 유저에 대한 당신의 인상을 반영하여 대화하세요.
"""
    
    return prompt
```

## 3.6 UI - 유저 프로필 화면

```
┌─────────────────────────────────────────────────┐
│ 👤 내 프로필                            [수정]  │
├─────────────────────────────────────────────────┤
│                                                 │
│ 이름: 카카시                                    │
│ 능력: 뇌절 (전기 계열)                          │
│       "손끝에 전기를 모아 적의 심장을 관통"       │
│                                                 │
│ ─────────────────────────────────────────────── │
│                                                 │
│ 📊 성격 분석                                    │
│ • 도발적  • 자신감  • 충동적                     │
│                                                 │
│ ─────────────────────────────────────────────── │
│                                                 │
│ 🎭 캐릭터들의 평가                               │
│                                                 │
│ 주창윤: "만만해 보이는 놈" (적대적)              │
│ 표다은: "재미있는 신입" (우호적)                 │
│ 황인하: "건방진 놈" (경계)                       │
│                                                 │
│ ─────────────────────────────────────────────── │
│                                                 │
│ 📜 주요 행동 기록                               │
│ • 주창윤의 상의를 찢음                          │
│ • 주창윤에게 싸움을 걸음                        │
│ • 자신을 "카카시"라고 소개                      │
│                                                 │
└─────────────────────────────────────────────────┘
```

---

# 4. 캐릭터 속마음 시스템

## 4.1 개요

캐릭터가 대사 외에 **속마음(내면의 생각)**을 별도로 보여주는 시스템입니다.
유저가 캐릭터의 진짜 감정과 의도를 파악할 수 있습니다.

## 4.2 속마음 표시 방식

```
┌─────────────────────────────────────────────────┐
│ 👤 주창윤                                        │
│                                                 │
│ "야, 뭐? 이상한 놈? 큭... 웃기시네."              │
│                                                 │
│ [💭 속마음 보기]                                 │
│                                                 │
│ ┌─────────────────────────────────────────────┐ │
│ │ 💭 주창윤의 속마음                           │ │
│ │                                             │ │
│ │ '뭐야, 이놈? 처음 보는 얼굴인데 눈빛이       │ │
│ │  예사롭지 않네. 일단 기선제압 해야겠어.      │ │
│ │  근데... 왜 날 똑바로 쳐다보는 거야?'        │ │
│ │                                             │ │
│ │ 현재 감정: 😤 허세 (내면: 약간 긴장)         │ │
│ │ 유저에 대한 평가: "만만해 보이지만 경계 필요" │ │
│ └─────────────────────────────────────────────┘ │
│                                                 │
│  [❤️]   [💢]   [🔥]   [⭐]                      │
└─────────────────────────────────────────────────┘
```

## 4.3 속마음 데이터 구조

```python
class InnerThought(BaseModel):
    """캐릭터 속마음"""
    
    character_id: str
    turn_id: str
    
    # 속마음 내용
    thought: str                    # "뭐야, 이놈? 처음 보는 얼굴인데..."
    
    # 감정 분석
    surface_emotion: str            # 겉으로 보이는 감정 ("허세")
    inner_emotion: str              # 실제 감정 ("긴장")
    emotion_gap: bool               # 겉과 속이 다른지 (True/False)
    
    # 유저 평가
    user_evaluation: str            # "만만해 보이지만 경계 필요"
    attitude_change: Optional[str]  # 태도 변화 ("경계 → 관심")
    
    # 의도
    intention: str                  # "기선제압하려 함"
```

## 4.4 속마음 생성 프롬프트

```python
INNER_THOUGHT_PROMPT = """
[캐릭터]
{character_info}

[상황]
{scene_context}

[캐릭터가 방금 한 말]
"{character_dialogue}"

[유저의 이전 행동/말]
{user_context}

[생성 요청]
이 캐릭터의 속마음을 작성하세요:
1. 겉으로 한 말과 다른 진짜 생각
2. 유저에 대한 솔직한 평가
3. 다음에 어떻게 할지 의도

[JSON 형식]
{
  "thought": "속마음 독백 (1~2문장)",
  "surface_emotion": "겉 감정",
  "inner_emotion": "속 감정", 
  "user_evaluation": "유저 평가",
  "intention": "의도"
}
"""
```

## 4.5 API 응답에 속마음 포함

```json
{
  "turn_id": "uuid",
  "speaker_id": "npc_joo_changyun",
  "speaker_name": "주창윤",
  "message": "야, 뭐? 이상한 놈? 큭... 웃기시네.",
  "action": "유저를 쏘아보며",
  
  "inner_thought": {
    "thought": "뭐야, 이놈? 눈빛이 예사롭지 않네. 일단 기선제압 해야겠어.",
    "surface_emotion": "허세",
    "inner_emotion": "긴장",
    "emotion_gap": true,
    "user_evaluation": "만만해 보이지만 경계 필요",
    "intention": "기선제압"
  }
}
```

## 4.6 속마음 해금 조건 (선택)

속마음을 항상 보여줄 수도 있고, **조건부로 해금**할 수도 있습니다:

```python
INNER_THOUGHT_UNLOCK_CONDITIONS = {
    "always": True,                    # 항상 표시
    "intimacy_threshold": 3.0,         # 친밀도 3 이상
    "special_moment": True,            # ⭐ 핵심 기억일 때만
    "premium_feature": False,          # 유료 기능
}
```

### 해금 UI 예시

```
[💭 속마음 보기] ← 클릭 가능

[🔒 속마음 잠김]
"친밀도를 3 이상 올리면 속마음을 볼 수 있습니다."
현재 친밀도: 1.2 / 3.0
```

## 4.7 속마음 히스토리

유저가 이전 대화의 속마음을 다시 볼 수 있는 기능:

```
┌─────────────────────────────────────────────────┐
│ 💭 주창윤의 속마음 기록                          │
├─────────────────────────────────────────────────┤
│                                                 │
│ [턴 14] "야, 뭐? 이상한 놈?"                     │
│ 💭 "눈빛이 예사롭지 않네. 기선제압 해야겠어."     │
│ 감정: 허세 (내면: 긴장)                         │
│                                                 │
│ [턴 16] "웃기시네, 진짜."                        │
│ 💭 "옷 찢는 게 전부야? 별거 아니네."             │
│ 감정: 깔봄 (내면: 살짝 놀람)                    │
│                                                 │
│ [턴 18] "착각하지 마. 네 수준엔 나 못 이겨."     │
│ 💭 "...아까보다 압박감이 느껴지는데?"            │
│ 감정: 허세 (내면: 위기감)                       │
│                                                 │
└─────────────────────────────────────────────────┘
```

---

# 📊 전체 시스템 연동도

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           SYNK MVP 시스템                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                 │
│  │ 유저 프로필  │    │ 캐릭터 DB   │    │ 관계 데이터  │                 │
│  │ (UserProfile)│    │ (Character) │    │(Relationship)│                 │
│  │             │    │             │    │             │                 │
│  │ • 닉네임     │    │ • 페르소나   │    │ • 친밀도     │                 │
│  │ • 능력      │    │ • 말투      │    │ • Dominance │                 │
│  │ • 성격 특성  │    │ • 트리거    │    │ • 감정 통계  │                 │
│  │ • 행동 기록  │    │ • 비밀      │    │ • 핵심 기억  │                 │
│  └──────┬──────┘    └──────┬──────┘    └──────┬──────┘                 │
│         │                  │                  │                         │
│         └────────────┬─────┴─────┬────────────┘                         │
│                      │           │                                      │
│                      ▼           ▼                                      │
│              ┌───────────────────────────┐                              │
│              │      프롬프트 빌더         │                              │
│              │   (Prompt Builder)        │                              │
│              └─────────────┬─────────────┘                              │
│                            │                                            │
│                            ▼                                            │
│              ┌───────────────────────────┐                              │
│              │       Gemini API          │                              │
│              │   (캐릭터 응답 생성)        │                              │
│              └─────────────┬─────────────┘                              │
│                            │                                            │
│              ┌─────────────┴─────────────┐                              │
│              │                           │                              │
│              ▼                           ▼                              │
│    ┌─────────────────┐        ┌─────────────────┐                      │
│    │   대화 응답      │        │   속마음 생성    │                      │
│    │ (티키타카 포함)  │        │ (Inner Thought) │                      │
│    └────────┬────────┘        └────────┬────────┘                      │
│             │                          │                               │
│             └────────────┬─────────────┘                               │
│                          │                                              │
│                          ▼                                              │
│              ┌───────────────────────────┐                              │
│              │      프론트엔드 표시       │                              │
│              │                           │                              │
│              │ • 캐릭터 대사 (말풍선)     │                              │
│              │ • 이모지 버튼              │                              │
│              │ • 속마음 패널              │                              │
│              │ • 관계 데이터 요약         │                              │
│              └─────────────┬─────────────┘                              │
│                            │                                            │
│                            ▼                                            │
│              ┌───────────────────────────┐                              │
│              │   유저 이모지 리액션       │                              │
│              │   ❤️ 💢 🔥 ⭐              │                              │
│              └─────────────┬─────────────┘                              │
│                            │                                            │
│                            ▼                                            │
│              ┌───────────────────────────┐                              │
│              │    데이터 수집 & 저장      │                              │
│              │                           │                              │
│              │ • 감정 로그               │                              │
│              │ • 트리거 키워드           │                              │
│              │ • 핵심 기억               │                              │
│              │ • 유저 프로필 업데이트     │                              │
│              └───────────────────────────┘                              │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

# 📝 개발 우선순위

| 순위 | 기능 | 중요도 | 예상 난이도 |
|------|------|--------|-------------|
| 1 | 이모지 리액션 UI | ⭐⭐⭐⭐⭐ | 쉬움 |
| 2 | 유저 프로필 DB 추가 | ⭐⭐⭐⭐⭐ | 중간 |
| 3 | 대화 상대 선택 드롭다운 | ⭐⭐⭐⭐ | 쉬움 |
| 4 | 티키타카 응답 구조 변경 | ⭐⭐⭐⭐ | 중간 |
| 5 | 속마음 생성 & 표시 | ⭐⭐⭐ | 중간 |
| 6 | 유저 정보 자동 추출 | ⭐⭐⭐ | 어려움 |

---

# ✅ 체크리스트

## 백엔드
- [ ] 이모지 리액션 API 완성
- [ ] 유저 프로필 테이블 추가
- [ ] 유저 정보 자동 추출 로직
- [ ] 티키타카 응답 구조 변경
- [ ] 속마음 생성 프롬프트 추가

## 프론트엔드
- [ ] 이모지 버튼 UI (❤️💢🔥⭐)
- [ ] 대화 상대 선택 드롭다운
- [ ] 속마음 패널 (토글)
- [ ] 유저 프로필 화면
- [ ] 관계 데이터 요약 패널 개선

---

> 문의사항은 언제든 말씀해주세요! 🚀
